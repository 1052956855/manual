# 1.介绍
**告警**提供了对集群内的监控数据以及服务有异常时的告警功能。告警分为**指标告警**和**服务告警**，**指标告警**可以对监控页面中的指标创建自定义告警，**服务告警**则是套件内组件运行异常时会自动触发的告警，在套件安装时已经创建，无需手工干预。

# 2.使用

## 2.1入口
套件首页点击**运维中心**卡片，并一次点击进入上侧的**监控告警**、左侧边栏的**告警**图标，即可进入告警页面。

![](/平台运维/告警/告警入口.png)

![](/平台运维/告警/告警入口2.png)


**注意**：如果找不到入口则是权限不足，请使用具有**Administrator**角色权限的账户登录。


## 2.2指标告警
告警首页默认呈现的即**指标告警**页面。
### 2.2.1创建指标告警
点击【`创建告警`】按钮，在弹出的**创建告警**对话框中，依次选择或填入内容即可创建相应指标报警。

![](/平台运维/告警/创建指标告警.png)

- _告警名称_：必填，输入的名称最好能够表征相应告警的内容，如创建tbds-10-254-83-16机器CPU1的1分钟平均负载，则可以命名为_tbds-10-254-83-16_CPU1_1分钟平均负载_。
- _是否开启_：告警是否开启的开关。在某些情况下想暂时关闭告警则可以把该选项置为关闭状态。
- _通知方式_：复选项，定义告警时的通知方式。每次告警同时还会发站内信给接收人。
- _接收人_：告警的汇报对象。
- _指标分类_：必选项，告警的具体指标名称。
    * _全部服务_：指标的分类列表，与**监控**页面的监控指标分类一致。选择某一分类后旁边的下拉框可选择具体的指标名称。
    * _指标名称_：某一指标分类中的指标名称列表，与**监控**页面的监控指标分类一致。
    * _指标维度_：某些指标具有额外的指标维度，比如当选择**硬件指标**分类中的**内存使用_总量**指标时，下方会出现**指标维度**选项。在第一个下拉框中选择**host_name**维度，在第二个下拉框中选择具体的指标维度值，如**tbds-10-254-83-16**，选择*****表示全选（全选功能在套件4.0.4.1及以后的版本中可用）。指标是否具有指标维度与指标的定义有关，指标定义在监控页面。
    
    ![](/平台运维/告警/指标分类及指标维度.png)

- _告警条件_：分为阈值、同比、环比三种方式。
    * _阈值_：设定告警触发的数值。
    * _同比_：与上一天同一时刻相比增长的百分比（可以为负数）。
    * _环比_：与上一指标检测周期相比增长的百分比（可以为负数）。
    对于上面每一种方式，可以分别定义**区间外**、**小于**、**大于**三种告警方式。
    
    ![](/平台运维/告警/告警条件.png)

- _检测周期_：检查告警指标的时间间隔，默认为1分钟，即每1分钟就会去检查定义的告警是否符合触发条件。

###2.3.2指标告警的查询、过滤和列表展示

phoenix页面左侧区域点击切换到【**设置**】页签，输入**函数名称**（点击**新增一行**可同时添加多个UDF），最后上传jar文件，创建成功后即可在sql中使用。如果需要修改则重新创建即可。

![](/数据应用/数据分析/数据分析创建phoenix UDF.png)

**注意1**：如果没有数据库权限请在**库表管理**中申请。
**注意2**：编写phoenix UDF需要实现_org.apache.phoenix.expression.function.ScalarFunction_类，建议使用支持hbase1.2+，phoenix 4.8.1+以上的版本作为依赖进行开发，具体请参考[这里](https://phoenix.apache.org/udf.html)。

## 2.4添加phoenix库表映射

hbase属于nosql数据库，要使用sql操作hbase首先需要将qualifier映射为phoenix的column。数据分析中进行映射非常方便，在phoenix页面中点击左上区域如下图所示的图标：

![](/数据应用/数据分析/数据分析创建phoenix映射.png)

在弹出的对话框中选择hbase的表空间和表，并在下方每行中依次输入columnFamily、qualifier、数据类型（不需要的可以不进行映射，也可以自行任意添加）。

![](/数据应用/数据分析/数据分析phoenix映射对话框.png)


点击确定，则会创建同名的phoenix表，字段名则与qualifier相同，如下图所示。

![](/数据应用/数据分析/数据分析映射后的phoenix表.png)

接下来就可以使用phoenix sql进行查询了。

**注意**：**TBDS4.0.4.1**之前的版本一旦映射成功是无法修改列的数据类型的，也无法将该列删除，因此使用的时候需特别注意。**TBDS4.0.4.1**及之后的版本则无此限制。













